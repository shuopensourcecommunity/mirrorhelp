image: node:latest

pages:
  before_script:
    - mkdir -p /home/gitlab-runner/.ssh
    - echo $SSH_PRIVATE_KEY_DEV >> /home/gitlab-runner/.ssh/id_rsa
    - chmod -R 700 /home/gitlab-runner/.ssh
    - npm install -g gitbook-cli
    - test -e package.json && npm install
  script:
    - gitbook build
    - scp -P 26 -r _book/* $DEPLOY_USER@$DEPLOY_SERVER_DEV:$WEB_DIR 
  artifacts:
    paths:
      - _book
  cache:
    paths:
      - node_modules
    key: project
  only:
    - master
